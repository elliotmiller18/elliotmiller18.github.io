<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="assets/jigglypuff-icon.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elliot Miller - Personal</title>
    <link rel="stylesheet" href="dropdowns.css">
    <style>
        body {
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background-color: white;
            line-height: 1.6;
            padding: 40px 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-weight: bold;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .nav-links {
            margin-bottom: 40px;
        }

        .nav-links a {
            color: black;
            text-decoration: none;
            margin: 0 15px;
        }

        .nav-links a:hover {
            text-decoration: underline;
        }

        .section {
            margin-bottom: 40px;
            padding-bottom: 30px;
        }

        .section-title {
            font-weight: bold;
            font-size: 1.4em;
            margin-bottom: 20px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
        }

        .chess-ratings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .rating-card {
            border: 1px solid #ccc;
            padding: 15px;
            text-align: center;
        }

        .rating-type {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .rating-value {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .rating-date {
            font-size: 0.9em;
            color: #666;
        }

        .chess-profile-link {
            text-align: center;
            margin-top: 20px;
        }

        .chess-profile-link a {
            color: black;
            text-decoration: none;
            font-weight: bold;
        }

        .chess-profile-link a:hover {
            text-decoration: underline;
        }

        .chess-embed-toggle {
            background: none;
            border: none;
            padding: 0;
            font: inherit;
            color: black;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
        }

        .chess-embed-toggle:hover {
            text-decoration: underline;
        }

        .interests {
            margin-top: 30px;
        }

        .interests ul {
            list-style-type: disc;
            margin-left: 20px;
        }

        .interests li {
            margin-bottom: 8px;
        }

        .update-note {
            font-size: 0.8em;
            color: #666;
            font-style: italic;
            text-align: center;
            margin-top: 15px;
        }

        .character-icon {
            vertical-align: middle;
            margin: 0 3px;
            width: 20px;
            height: 20px;
        }

        .rating-progress {
            font-size: 0.9em;
            margin-top: 8px;
            color: #333;
            font-weight: bold;
        }

        .rating-increase {
            color: #22c55e;
        }

        .rating-decrease {
            color: #ef4444;
        }

        .chess-fun-stats {
            border: 1px solid #ccc;
            padding: 15px;
            margin-top: 20px;
        }

        .chess-fun-title {
            font-weight: bold;
            margin-bottom: 12px;
            text-align: center;
        }

        .chess-fun-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .chess-fun-item {
            border: 1px solid #eee;
            padding: 10px;
            text-align: center;
        }

        .chess-fun-label {
            font-weight: bold;
            margin-bottom: 6px;
        }

        .chess-fun-value {
            font-size: 1.05em;
        }

        .chess-game-dots {
            display: flex;
            gap: 8px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .game-dot-link {
            display: inline-flex;
        }

        .game-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            display: inline-block;
            border: 1px solid #333;
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }

        .game-dot-link:hover .game-dot {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
        }

        .game-win {
            background: #22c55e;
        }

        .game-loss {
            background: #ef4444;
        }

        .game-draw {
            background: #9ca3af;
        }

        .chess-fun-sub {
            font-size: 0.85em;
            color: #666;
            margin-top: 6px;
        }

        .chess-magnum {
            border: 1px solid #ccc;
            padding: 15px;
            margin-top: 20px;
        }

        .chess-embed {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            pointer-events: none;
            transition: max-height 0.35s ease, opacity 0.2s ease;
            border: 0;
            padding: 0;
        }

        .chess-embed.is-open {
            max-height: 2000px;
            opacity: 1;
            pointer-events: auto;
            border: 1px solid #eee;
            padding: 8px;
        }

        .chess-link-sep {
            margin: 0 10px;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="dropdowns-root"></div>
    <script src="dropdowns.js"></script>
    <div class="container">
        <div class="header">
            <h1>Personal</h1>
            <div class="nav-links">
                <a href="index.html">home</a> |
                <a href="projects.html">projects</a> |
                <a href="work.html">work</a>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Chess.com Rating</div>
            
            <div class="chess-ratings">
                <div class="rating-card">
                    <div class="rating-type">Rapid Rating</div>
                    <div class="rating-value" id="rapid-rating">Loading...</div>
                    <div class="rating-date" id="rapid-date">Fetching from chess.com...</div>
                    <div class="rating-progress" id="rating-progress">Progress since April 2025: calculating...</div>
                </div>
            </div>

            <div class="chess-fun-stats">
                <div class="chess-fun-title">past <span id="rapid-days">30</span> days</div>
                <div class="chess-fun-grid">
                    <div class="chess-fun-item">
                        <div class="chess-fun-label">Win ratio</div>
                        <div class="chess-fun-value" id="rapid-win-ratio">Loading...</div>
                    </div>
                    <div class="chess-fun-item">
                        <div class="chess-fun-label">Rating +/-</div>
                        <div class="chess-fun-value" id="rapid-rating-change">Loading...</div>
                    </div>
                    <div class="chess-fun-item">
                        <div class="chess-fun-label">Last 5 rapid games</div>
                        <div class="chess-game-dots" id="rapid-game-dots">Loading...</div>
                    </div>
                </div>
            </div>

            <div class="chess-profile-link">
                <button class="chess-embed-toggle" id="toggle-chess-embed" aria-expanded="false" aria-controls="chess-embed">View my best game</button>
                <span class="chess-link-sep">|</span>
                <a href="https://chess.com/member/bhfelliot" target="_blank">View full chess.com profile (leave website)</a>
            </div>

            <div class="update-note" id="update-status">
                Live rating from chess.com API (if this is stuck loading chess.com api can be unresponsive)
            </div>

            <div class="chess-magnum">
                <div class="chess-embed" id="chess-embed">
                    <iframe id="14615259" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="https://www.chess.com/emboard?id=14615259"></iframe><script nonce="chesscom-diagram">window.addEventListener("message",e=>{e['data']&&"14615259"===e['data']['id']&&document.getElementById(`${e['data']['id']}`)&&(document.getElementById(`${e['data']['id']}`).style.height=`${e['data']['frameHeight']+37}px`)});</script>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section">
                <div class="section-title">Interests & Hobbies</div>
                <div class="interests">
                    <ul>
                        <li>Super Smash Bros. Melee - <img src="assets/jigglypuff-icon.png" alt="Jigglypuff" class="character-icon" id="jigglypuff-icon" style="cursor: pointer;"><img src="assets/falco-icon.png" alt="Falco" class="character-icon" id="falco-icon" style="cursor: pointer;"></li>
                        <li>Chess - I play The Queen's Gambit and am looking for a new opening with black.</li>
                        <li>Tea - Love black tea, especially Earl Grey. Favorite shop: <a href="https://teahaus.com/" target="_blank">Teahaus</a> in Ann Arbor, MI for loose-leaf tea</li>
                        <li>Reading - Favorite books: <a href="https://www.goodreads.com/book/show/1617.Night" target="_blank">Night</a> (my favorite, won the author a Nobel Peace Prize), <a href="https://www.goodreads.com/book/show/5129.Brave_New_World" target="_blank">Brave New World</a>, <a href="https://www.goodreads.com/book/show/194746.No_Longer_Human" target="_blank">No Longer Human</a>, <a href="https://www.goodreads.com/book/show/929782.Martin_Eden" target="_blank">Martin Eden</a>, <a href="https://www.goodreads.com/book/show/11297.Norwegian_Wood" target="_blank">Norwegian Wood</a>, <a href="https://www.goodreads.com/book/show/2638701-violence" target="_blank">Violence</a>, <a href="https://www.goodreads.com/book/show/10046142-dancing-in-the-Glory-of-monsters" target="_blank">Dancing in the glory of Monsters: The Collapse of the Congo and the Great War of Africa</a></li>
                        <li>Chinese - 我们说中文吧!</li>
                        <li>Processor Design and Hardware Emulation - Check out my <a href="https://github.com/elliotmiller18/gb-emulator" target="_blank">Gameboy emulator</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Chess.com API scraper for rapid rating
        async function fetchChessRating() {
            const username = 'bhfelliot';
            const rapidRatingElement = document.getElementById('rapid-rating');
            const rapidDateElement = document.getElementById('rapid-date');
            const statusElement = document.getElementById('update-status');
            
            try {
                // Fetch player stats from chess.com API
                const response = await fetch(`https://api.chess.com/pub/player/${username}/stats`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Extract rapid rating data
                if (data.chess_rapid && data.chess_rapid.last) {
                    const rapidRating = data.chess_rapid.last.rating;
                    const lastGameDate = new Date(data.chess_rapid.last.date * 1000);
                    const formattedDate = lastGameDate.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric',
                        year: 'numeric'
                    });
                    
                    // Calculate progress since April 2025
                    const april2025Rating = 909;
                    const ratingChange = rapidRating - april2025Rating;
                    const progressElement = document.getElementById('rating-progress');
                    
                    let progressText = `Progress since starting consistently playing chess (April 2025): `;
                    if (ratingChange > 0) {
                        progressText += `+${ratingChange} points`;
                        progressElement.className = 'rating-progress rating-increase';
                    } else if (ratingChange < 0) {
                        progressText += `${ratingChange} points`;
                        progressElement.className = 'rating-progress rating-decrease';
                    } else {
                        progressText += `No change`;
                        progressElement.className = 'rating-progress';
                    }
                    
                    // Update the display
                    rapidRatingElement.textContent = rapidRating;
                    rapidDateElement.textContent = `Last game: ${formattedDate}`;
                    progressElement.textContent = progressText;
                    statusElement.textContent = `Updated from chess.com API - ${new Date().toLocaleTimeString()}`;
                    
                } else {
                    throw new Error('No rapid rating data found');
                }
                
            } catch (error) {
                console.error('Error fetching chess rating:', error);
                rapidRatingElement.textContent = 'Error';
                rapidDateElement.textContent = 'Could not fetch rating';
                statusElement.textContent = 'API error - click profile link for current rating';
                
                // Fallback: try to show a cached or default rating
                setTimeout(() => {
                    const cachedRating = 1277;
                    const april2025Rating = 909;
                    const cachedChange = cachedRating - april2025Rating;
                    
                    rapidRatingElement.textContent = cachedRating;
                    rapidDateElement.textContent = 'Cached rating';
                    
                    const progressElement = document.getElementById('rating-progress');
                    progressElement.textContent = `Progress since April 2025: +${cachedChange} points`;
                    progressElement.className = 'rating-progress rating-increase';
                    
                    statusElement.textContent = 'Showing cached rating - API unavailable';
                }, 2000);
            }
        }

        async function fetchRapidGameStats() {
            const username = 'bhfelliot';
            const DAYS = 30;
            const winRatioElement = document.getElementById('rapid-win-ratio');
            const ratingChangeElement = document.getElementById('rapid-rating-change');
            const dotsElement = document.getElementById('rapid-game-dots');
            const statusElement = document.getElementById('update-status');

            const daysTitle = document.getElementById('rapid-days');
            const daysWin = document.getElementById('rapid-days-1');
            const daysRating = document.getElementById('rapid-days-2');

            if (daysTitle) {
                daysTitle.textContent = DAYS;
            }
            if (daysWin) {
                daysWin.textContent = DAYS;
            }
            if (daysRating) {
                daysRating.textContent = DAYS;
            }

            const drawResults = new Set([
                'stalemate',
                'agreed',
                'repetition',
                'insufficient',
                'timevsinsufficient',
                '50move'
            ]);

            const cutoff = Math.floor(Date.now() / 1000) - DAYS * 24 * 60 * 60;

            try {
                const archivesResponse = await fetch(`https://api.chess.com/pub/player/${username}/games/archives`);
                if (!archivesResponse.ok) {
                    throw new Error(`Archives HTTP error! status: ${archivesResponse.status}`);
                }

                const archivesData = await archivesResponse.json();
                const archives = archivesData.archives || [];
                if (!archives.length) {
                    throw new Error('No archives found');
                }

                const recentGames = [];

                for (let i = archives.length - 1; i >= 0; i--) {
                    const archiveUrl = archives[i];
                    const parts = archiveUrl.split('/');
                    const month = parseInt(parts[parts.length - 1], 10);
                    const year = parseInt(parts[parts.length - 2], 10);

                    if (!Number.isNaN(year) && !Number.isNaN(month)) {
                        const endOfMonth = new Date(year, month, 0, 23, 59, 59);
                        if (endOfMonth.getTime() / 1000 < cutoff) {
                            break;
                        }
                    }

                    const gamesResponse = await fetch(archiveUrl);
                    if (!gamesResponse.ok) {
                        throw new Error(`Games HTTP error! status: ${gamesResponse.status}`);
                    }

                    const gamesData = await gamesResponse.json();
                    const games = gamesData.games || [];

                    for (const game of games) {
                        if (game.time_class !== 'rapid') {
                            continue;
                        }
                        if (game.end_time < cutoff) {
                            continue;
                        }
                        const whiteUser = game.white?.username?.toLowerCase();
                        const blackUser = game.black?.username?.toLowerCase();
                        if (whiteUser !== username && blackUser !== username) {
                            continue;
                        }
                        recentGames.push(game);
                    }
                }

                recentGames.sort((a, b) => a.end_time - b.end_time);

                const totalGames = recentGames.length;
                let wins = 0;
                let losses = 0;
                let draws = 0;

                function getPlayerSide(game) {
                    const whiteUser = game.white?.username?.toLowerCase();
                    if (whiteUser === username) {
                        return 'white';
                    }
                    return 'black';
                }

                function getResultType(result) {
                    if (result === 'win') {
                        return 'win';
                    }
                    if (drawResults.has(result)) {
                        return 'draw';
                    }
                    return 'loss';
                }

                for (const game of recentGames) {
                    const side = getPlayerSide(game);
                    const result = game[side]?.result;
                    const resultType = getResultType(result);
                    if (resultType === 'win') {
                        wins += 1;
                    } else if (resultType === 'draw') {
                        draws += 1;
                    } else {
                        losses += 1;
                    }
                }

                if (totalGames > 0) {
                    const winRatio = Math.round((wins / totalGames) * 100);
                    winRatioElement.textContent = `${winRatio}% (${wins}W-${losses}L-${draws}D)`;
                } else {
                    winRatioElement.textContent = 'No rapid games';
                }

                if (totalGames > 0) {
                    const firstGame = recentGames[0];
                    const lastGame = recentGames[totalGames - 1];
                    const firstSide = getPlayerSide(firstGame);
                    const lastSide = getPlayerSide(lastGame);
                    const firstRating = firstGame[firstSide]?.rating ?? 0;
                    const lastRating = lastGame[lastSide]?.rating ?? 0;
                    const ratingChange = lastRating - firstRating;
                    const ratingText = ratingChange > 0 ? `+${ratingChange}` : `${ratingChange}`;
                    ratingChangeElement.textContent = ratingText;
                    ratingChangeElement.className = 'chess-fun-value';
                    if (ratingChange > 0) {
                        ratingChangeElement.classList.add('rating-increase');
                    } else if (ratingChange < 0) {
                        ratingChangeElement.classList.add('rating-decrease');
                    }
                } else {
                    ratingChangeElement.textContent = 'N/A';
                    ratingChangeElement.className = 'chess-fun-value';
                }

                dotsElement.innerHTML = '';
                if (totalGames > 0) {
                    const lastFive = recentGames.slice(-5);
                    for (const game of lastFive) {
                        const side = getPlayerSide(game);
                        const result = game[side]?.result;
                        const resultType = getResultType(result);
                        const opponent = side === 'white' ? game.black?.username : game.white?.username;
                        const endDate = new Date(game.end_time * 1000).toLocaleDateString('en-US', {
                            month: 'short',
                            day: 'numeric',
                            year: 'numeric'
                        });

                        const dot = document.createElement('span');
                        dot.className = `game-dot game-${resultType}`;

                        const link = document.createElement('a');
                        link.className = 'game-dot-link';
                        link.href = game.url || '#';
                        link.target = '_blank';
                        link.rel = 'noopener';
                        link.title = `${resultType.toUpperCase()} vs ${opponent || 'opponent'} on ${endDate}`;
                        link.appendChild(dot);
                        dotsElement.appendChild(link);
                    }
                } else {
                    dotsElement.textContent = 'No rapid games yet';
                }

                statusElement.textContent = `Updated from chess.com API - ${new Date().toLocaleTimeString()}`;
            } catch (error) {
                console.error('Error fetching rapid game stats:', error);
                winRatioElement.textContent = 'Unavailable';
                ratingChangeElement.textContent = 'Unavailable';
                ratingChangeElement.className = 'chess-fun-value';
                dotsElement.textContent = 'API error';
                statusElement.textContent = 'API error - click profile link for current rating';
            }
        }

        // Fetch rating when page loads
        window.addEventListener('load', function() {
            fetchChessRating();
            fetchRapidGameStats();

            const toggle = document.getElementById('toggle-chess-embed');
            const embed = document.getElementById('chess-embed');

            if (toggle && embed) {
                const setOpen = (open, shouldScroll) => {
                    embed.classList.toggle('is-open', open);
                    toggle.setAttribute('aria-expanded', open ? 'true' : 'false');
                    // No auto-scroll on open/close.
                };

                toggle.addEventListener('click', function() {
                    const isOpen = embed.classList.contains('is-open');
                    setOpen(!isOpen, false);
                });

                if (window.location.hash === '#chess-embed') {
                    setOpen(true, false);
                }
            }
        });

        // Optional: Refresh rating every 5 minutes
        setInterval(function() {
            fetchChessRating();
            fetchRapidGameStats();
        }, 5 * 60 * 1000);

        // Reusable function for character sound effects
        function addCharacterSound(iconId, audioSrc, volume = 0.035) {
            const icon = document.getElementById(iconId);
            const audio = new Audio(audioSrc);
            audio.volume = volume;

            icon.addEventListener('click', function() {
                audio.currentTime = 0; // Reset to start if already playing
                audio.play().catch(function(error) {
                    console.log('Audio playback failed:', error);
                });
            });
        }

        // Add sound effects for both characters
        addCharacterSound('jigglypuff-icon', 'assets/Ping.ogg');
        addCharacterSound('falco-icon', 'assets/falco.mp3');
    </script>
</body>
</html> 
